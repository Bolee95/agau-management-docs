<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>TokenizationProcessor</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../book.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">contracts</li><li class="chapter-item "><a href="../../../../contracts/admin-ops/index.html">❱ admin-ops</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/admin-ops/IOpsEvents.sol/interface.IOpsEvents.html">IOpsEvents</a></li><li class="chapter-item "><a href="../../../../contracts/admin-ops/OpsBaseProcessor.sol/abstract.OpsBaseProcessor.html">OpsBaseProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/admin-ops/OpsProcessor.sol/contract.OpsProcessor.html">OpsProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/admin-ops/OpsStorage.sol/contract.OpsStorage.html">OpsStorage</a></li><li class="chapter-item "><a href="../../../../contracts/admin-ops/OpsTypes.sol/library.OpsTypes.html">OpsTypes</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/bridge/index.html">❱ bridge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/bridge/BridgeInteractor.sol/abstract.BridgeInteractor.html">BridgeInteractor</a></li><li class="chapter-item "><a href="../../../../contracts/bridge/BridgeMediator.sol/contract.BridgeMediator.html">BridgeMediator</a></li><li class="chapter-item "><a href="../../../../contracts/bridge/BridgeMessagesMapper.sol/abstract.BridgeMessagesMapper.html">BridgeMessagesMapper</a></li><li class="chapter-item "><a href="../../../../contracts/bridge/BridgeModeSwitch.sol/abstract.BridgeModeSwitch.html">BridgeModeSwitch</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/certificates/index.html">❱ certificates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/certificates/Certificates.sol/contract.Certificates.html">Certificates</a></li><li class="chapter-item "><a href="../../../../contracts/certificates/ERC1155D.sol/abstract.ERC1155D.html">ERC1155D</a></li><li class="chapter-item "><a href="../../../../contracts/certificates/URIBuilder.sol/contract.URIBuilder.html">URIBuilder</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../contracts/certs-management/index.html">❱ certs-management</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/certs-management/common/index.html">❱ common</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/certs-management/common/BaseManagementStorage.sol/contract.BaseManagementStorage.html">BaseManagementStorage</a></li><li class="chapter-item "><a href="../../../../contracts/certs-management/common/IRequestsEvents.sol/interface.IRequestsEvents.html">IRequestsEvents</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/certs-management/redemption/index.html">❱ redemption</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/certs-management/redemption/RedemptionProcessor.sol/contract.RedemptionProcessor.html">RedemptionProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/certs-management/redemption/RedemptionStorage.sol/contract.RedemptionStorage.html">RedemptionStorage</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../contracts/certs-management/tokenization/index.html">❱ tokenization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../contracts/certs-management/tokenization/TokenizationProcessor.sol/contract.TokenizationProcessor.html" class="active">TokenizationProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/certs-management/tokenization/TokenizationStorage.sol/contract.TokenizationStorage.html">TokenizationStorage</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../../contracts/common/index.html">❱ common</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/common/ArrayUtils.sol/library.ArrayUtils.html">ArrayUtils</a></li><li class="chapter-item "><a href="../../../../contracts/common/BaseProcessor.sol/abstract.BaseProcessor.html">BaseProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/common/BridgeInterable.sol/abstract.BridgeInterable.html">BridgeInterable</a></li><li class="chapter-item "><a href="../../../../contracts/common/CallGuard.sol/abstract.CallGuard.html">CallGuard</a></li><li class="chapter-item "><a href="../../../../contracts/common/HolderWallet.sol/contract.HolderWallet.html">HolderWallet</a></li><li class="chapter-item "><a href="../../../../contracts/common/RelayerAware.sol/abstract.RelayerAware.html">RelayerAware</a></li><li class="chapter-item "><a href="../../../../contracts/common/WalletManager.sol/contract.WalletManager.html">WalletManager</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/forwarder/index.html">❱ forwarder</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/forwarder/Forwarder.sol/contract.Forwarder.html">Forwarder</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/multistep/index.html">❱ multistep</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/multistep/Process.sol/struct.Signature.html">Signature</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/Process.sol/struct.Process.html">Process</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/Process.sol/library.ProcessLib.html">ProcessLib</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/ProcessFactory.sol/contract.ProcessFactory.html">ProcessFactory</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/ProcessManager.sol/contract.ProcessManager.html">ProcessManager</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/ProcessTypes.sol/constants.ProcessTypes.html">ProcessTypes constants</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/Step.sol/struct.Step.html">Step</a></li><li class="chapter-item "><a href="../../../../contracts/multistep/Step.sol/library.StepLib.html">StepLib</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/roles/index.html">❱ roles</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/roles/BaseRoleProcessor.sol/abstract.BaseRoleProcessor.html">BaseRoleProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/roles/RoleAssignProcessor.sol/contract.RoleAssignProcessor.html">RoleAssignProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/roles/RoleRemoveProcessor.sol/contract.RoleRemoveProcessor.html">RoleRemoveProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/roles/RoleRequestsStorage.sol/contract.RoleRequestsStorage.html">RoleRequestsStorage</a></li><li class="chapter-item "><a href="../../../../contracts/roles/RolesManager.sol/contract.RolesManager.html">RolesManager</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/shipment/index.html">❱ shipment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/shipment/inbound/index.html">❱ inbound</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/shipment/inbound/InboundShipmentProcessor.sol/contract.InboundShipmentProcessor.html">InboundShipmentProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/shipment/inbound/InboundShipmentStorage.sol/contract.InboundShipmentStorage.html">InboundShipmentStorage</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/shipment/outbound/index.html">❱ outbound</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../contracts/shipment/outbound/OutboundShipmentProcessor.sol/contract.OutboundShipmentProcessor.html">OutboundShipmentProcessor</a></li><li class="chapter-item "><a href="../../../../contracts/shipment/outbound/OutboundShipmentStorage.sol/contract.OutboundShipmentStorage.html">OutboundShipmentStorage</a></li></ol></li><li class="chapter-item "><a href="../../../../contracts/shipment/BaseShipmentStorage.sol/abstract.BaseShipmentStorage.html">BaseShipmentStorage</a></li><li class="chapter-item "><a href="../../../../contracts/shipment/SharedShipmentStorage.sol/contract.SharedShipmentStorage.html">SharedShipmentStorage</a></li><li class="chapter-item "><a href="../../../../contracts/shipment/ShipmentTypes.sol/library.ShipmentTypes.html">ShipmentTypes</a></li><li class="chapter-item "><a href="../../../../contracts/shipment/ShipmentUtils.sol/library.ShipmentUtils.html">ShipmentUtils</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MOONSTRUCK-team/agau-management" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tokenizationprocessor"><a class="header" href="#tokenizationprocessor">TokenizationProcessor</a></h1>
<p><a href="https://github.com/MOONSTRUCK-team/agau-management/blob/f4738cc1bed2ef96985e8eed62680b201c03aebf/contracts/certs-management/tokenization/TokenizationProcessor.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ITokenizationRecovery, <a href="/contracts/certs-management/common/IRequestsEvents.sol/interface.IRequestsEvents.html">IRequestsEvents</a>, ERC2771Context, <a href="/contracts/bridge/BridgeInteractor.sol/abstract.BridgeInteractor.html">BridgeInteractor</a>, ERC1155Holder, <a href="/contracts/bridge/BridgeMessagesMapper.sol/abstract.BridgeMessagesMapper.html">BridgeMessagesMapper</a></p>
<p><em>Contract responsible for managing the tokenization requests. It's responsible for following
the steps defined with <code>CREATE_TOKENIZATION</code> process and to provide updates of the tokenisation
relevant data. It uses <code>TokenizationStorage</code> to store the data and multiple contracts to interact
with and update the data. Communicates with the L1 contracts via bridge by implementing <code>BridgeInteractor</code>
contract. Contract can also handle meta transactions by implementing <code>ERC2771Context</code> contract.
The tokenization process is defined with a goal of tokenizing previously create NFT certificates on L1.
At the end of the process, NFT certificates are stored in a special wallet called <code>Global Certificate</code>
which is holding all the certificates tokenized on L1. It's a single wallet holding all the certificates
that can be checked for in order to prove that L1 tokens are 1:1 ratio with the tokenized precious metals.
Contract is aware of setting if the bridge is active or not. In case of inactivity, it will not send
messages and will allow futher execution of the tokenisation steps. In this case, protocol integrity
will relay on the manual execution of the operations on the other side of the bridge previously done
by the messages send.
The following are the ordered function calls for tokenization process, as well as the roles allowed to
execute them (defined by process during deployment):
1.<code>createRequest</code> / <code>recreateRequest</code> -&gt; TM
2.<code>approveRequest</code> -&gt; TMA, TME, AU
3.<code>completeRequest</code> -&gt; AU
-.<code>rejectRequest</code> -&gt; Depends on the step
-.<code>fixReleaseTokensMessage</code> -&gt; <code>BridgeMediator</code> contract</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="_processmanager"><a class="header" href="#_processmanager">_processManager</a></h3>
<p><em><code>ProcessManager</code> contract</em></p>
<pre><code class="language-solidity">ProcessManager private immutable _processManager;
</code></pre>
<h3 id="_certscollection"><a class="header" href="#_certscollection">_certsCollection</a></h3>
<p><em><code>Certificates</code> contract address</em></p>
<pre><code class="language-solidity">Certificates private immutable _certsCollection;
</code></pre>
<h3 id="_walletmanager"><a class="header" href="#_walletmanager">_walletManager</a></h3>
<p><em><code>WalletManager</code> contract address</em></p>
<pre><code class="language-solidity">WalletManager private immutable _walletManager;
</code></pre>
<h3 id="_inboundshipmentstorage"><a class="header" href="#_inboundshipmentstorage">_inboundShipmentStorage</a></h3>
<p><em><code>InboundShipmentStorage</code> contract</em></p>
<pre><code class="language-solidity">InboundShipmentStorage private immutable _inboundShipmentStorage;
</code></pre>
<h3 id="_tokenizationstorage"><a class="header" href="#_tokenizationstorage">_tokenizationStorage</a></h3>
<p><em><code>TokenizationStorage</code> contract</em></p>
<pre><code class="language-solidity">TokenizationStorage private immutable _tokenizationStorage;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="requestexists"><a class="header" href="#requestexists">requestExists</a></h3>
<pre><code class="language-solidity">modifier requestExists(uint256 requestId);
</code></pre>
<h3 id="validshipments"><a class="header" href="#validshipments">validShipments</a></h3>
<pre><code class="language-solidity">modifier validShipments(uint256[] calldata shipmentIds);
</code></pre>
<h3 id="validstatus"><a class="header" href="#validstatus">validStatus</a></h3>
<pre><code class="language-solidity">modifier validStatus(uint256 requestId, Status expectedStatus);
</code></pre>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<pre><code class="language-solidity">constructor(
    address trustedForwarder_,
    address bridgeMediator_,
    address processManager_,
    address inboundShipmentStorage_,
    address tokenizationStorage_,
    address certsCollection_,
    address walletManager_
) ERC2771Context(trustedForwarder_) BridgeInteractor(bridgeMediator_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>trustedForwarder_</code></td><td><code>address</code></td><td>Address of the <code>TrustedForwarder</code> contract</td></tr>
<tr><td><code>bridgeMediator_</code></td><td><code>address</code></td><td>Address of the <code>BridgeMediator</code> contract</td></tr>
<tr><td><code>processManager_</code></td><td><code>address</code></td><td>Address of the <code>ProcessManager</code> contract</td></tr>
<tr><td><code>inboundShipmentStorage_</code></td><td><code>address</code></td><td>Address of the <code>InboundShipmentStorage</code> contract</td></tr>
<tr><td><code>tokenizationStorage_</code></td><td><code>address</code></td><td>Address of the <code>TokenizationStorage</code> contract</td></tr>
<tr><td><code>certsCollection_</code></td><td><code>address</code></td><td>Address of the <code>Certificates</code> contract</td></tr>
<tr><td><code>walletManager_</code></td><td><code>address</code></td><td>Address of the <code>WalletManager</code> contracts</td></tr>
</tbody></table>
</div>
<h3 id="createrequest"><a class="header" href="#createrequest">createRequest</a></h3>
<p><em>Creates tokenisation request
Emits {RequestCreated} event</em></p>
<pre><code class="language-solidity">function createRequest(uint256[] calldata shipmentIds) external validShipments(shipmentIds);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shipmentIds</code></td><td><code>uint256[]</code></td><td>Identifiers of the shipments to be tokenized and part of the request</td></tr>
</tbody></table>
</div>
<h3 id="recreaterequest"><a class="header" href="#recreaterequest">recreateRequest</a></h3>
<p><em>Recreates tokenisation request
Emits {RequestRecreated} event</em></p>
<pre><code class="language-solidity">function recreateRequest(uint256 requestId, uint256[] calldata shipmentIds)
    external
    requestExists(requestId)
    validShipments(shipmentIds);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
<tr><td><code>shipmentIds</code></td><td><code>uint256[]</code></td><td>Identifiers of the shipments to be tokenized and part of the request</td></tr>
</tbody></table>
</div>
<h3 id="approverequest"><a class="header" href="#approverequest">approveRequest</a></h3>
<p><em>Approves tokenisation request
Emits {RequestApproved} event</em></p>
<pre><code class="language-solidity">function approveRequest(uint256 requestId) external requestExists(requestId) validStatus(requestId, Status.CREATED);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="completerequest"><a class="header" href="#completerequest">completeRequest</a></h3>
<p><em>Confirms that tokens are released and completes the request
Emits {RequestCompleted} event</em></p>
<pre><code class="language-solidity">function completeRequest(uint256 requestId) external requestExists(requestId) validStatus(requestId, Status.APPROVED);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="rejectrequest"><a class="header" href="#rejectrequest">rejectRequest</a></h3>
<p><em>Rejects the request
Emits {RequestRejected} event</em></p>
<pre><code class="language-solidity">function rejectRequest(uint256 requestId) external requestExists(requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="fixreleasetokensmessage"><a class="header" href="#fixreleasetokensmessage">fixReleaseTokensMessage</a></h3>
<p><em>Fixes the state of the protocol in case of the <code>releaseTokens</code> message failure
Callable only by bridge mediator contract
Emits {RequestReverted} event</em></p>
<pre><code class="language-solidity">function fixReleaseTokensMessage(bytes32 messageId)
    external
    onlyMediator
    dataForMessageExists(messageId)
    messageNotFixed(messageId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>messageId</code></td><td><code>bytes32</code></td><td>Identifier of the message</td></tr>
</tbody></table>
</div>
<h3 id="_sendminttokensmessage"><a class="header" href="#_sendminttokensmessage">_sendMintTokensMessage</a></h3>
<p><em>Sends <code>mintTokens</code> message to the bridge
Emits {MintTokensMessageSent} event</em></p>
<pre><code class="language-solidity">function _sendMintTokensMessage(uint256 requestId) private bridgeActive;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_sendreleasetokensmessage"><a class="header" href="#_sendreleasetokensmessage">_sendReleaseTokensMessage</a></h3>
<p><em>Sends <code>releaseTokens</code> message to the bridge
Emits {ReleaseTokensMessageSent} event</em></p>
<pre><code class="language-solidity">function _sendReleaseTokensMessage(uint256 requestId) private bridgeActive;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_sendtokenopsmessage"><a class="header" href="#_sendtokenopsmessage">_sendTokenOpsMessage</a></h3>
<p><em>Sends token message to the bridge</em></p>
<pre><code class="language-solidity">function _sendTokenOpsMessage(uint256 requestId, bytes4 methodSelector) private returns (bytes32 messageId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
<tr><td><code>methodSelector</code></td><td><code>bytes4</code></td><td>Selector of the method to call on the bridge receiver</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>messageId</code></td><td><code>bytes32</code></td><td>Identifier of the message</td></tr>
</tbody></table>
</div>
<h3 id="_revertcertstransfer"><a class="header" href="#_revertcertstransfer">_revertCertsTransfer</a></h3>
<p><em>Reverts the NFT Certificates transfer</em></p>
<pre><code class="language-solidity">function _revertCertsTransfer(uint256 requestId) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_transfercerts"><a class="header" href="#_transfercerts">_transferCerts</a></h3>
<p><em>Transfers the NFT Certificates depending on whether its the result of reverting process which depends on the <code>reverted</code> flag</em></p>
<pre><code class="language-solidity">function _transferCerts(uint256[] memory shipmentIds, bool reverted) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shipmentIds</code></td><td><code>uint256[]</code></td><td>Identifiers of the shipments</td></tr>
<tr><td><code>reverted</code></td><td><code>bool</code></td><td>Flag whether the transfer is reverted</td></tr>
</tbody></table>
</div>
<h3 id="_transfercertstoglobalcertwallet"><a class="header" href="#_transfercertstoglobalcertwallet">_transferCertsToGlobalCertWallet</a></h3>
<p><em>Transfers all of the certificates for <code>requestId</code> to the <code>Global Certificate</code> wallet</em></p>
<pre><code class="language-solidity">function _transferCertsToGlobalCertWallet(uint256 requestId) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_signprocess"><a class="header" href="#_signprocess">_signProcess</a></h3>
<p><em>Sign the process for the request if possible and return whether the step was updated</em></p>
<pre><code class="language-solidity">function _signProcess(address signer, uint256 requestId) private returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>signer</code></td><td><code>address</code></td><td>Address of the signer</td></tr>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the process</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Flag whether the step was updated after signing</td></tr>
</tbody></table>
</div>
<h3 id="_createrequestdata"><a class="header" href="#_createrequestdata">_createRequestData</a></h3>
<p><em>Creates <code>TokenizationStorage.Request</code> structure</em></p>
<pre><code class="language-solidity">function _createRequestData(uint256[] calldata shipmentIds, uint32 processId)
    private
    pure
    returns (TokenizationStorage.Request memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shipmentIds</code></td><td><code>uint256[]</code></td><td>Identifiers of the shipments in the request</td></tr>
<tr><td><code>processId</code></td><td><code>uint32</code></td><td>Identifier of the process</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>TokenizationStorage.Request</code></td><td><code>TokenizationStorage.Request</code> structure</td></tr>
</tbody></table>
</div>
<h3 id="_createmessageparams"><a class="header" href="#_createmessageparams">_createMessageParams</a></h3>
<p><em>Assembles a data that should be sent over the bridge</em></p>
<pre><code class="language-solidity">function _createMessageParams(uint256 requestId)
    private
    view
    returns (ForeignBridgeTypes.TokenOpsMessageConfig[] memory mintMessageParams);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>mintMessageParams</code></td><td><code>ForeignBridgeTypes.TokenOpsMessageConfig[]</code></td><td>Array of <code>TokenOpsMessageConfig</code> structure with the mint data</td></tr>
</tbody></table>
</div>
<h3 id="_revertifrequestcannotberecreated"><a class="header" href="#_revertifrequestcannotberecreated">_revertIfRequestCannotBeRecreated</a></h3>
<p><em>Checks and reverts if the request cannot be recreated</em></p>
<pre><code class="language-solidity">function _revertIfRequestCannotBeRecreated(uint256 requestId) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_shipmenttokenizable"><a class="header" href="#_shipmenttokenizable">_shipmentTokenizable</a></h3>
<p><em>Returns flag if the shipment is tokenizable</em></p>
<pre><code class="language-solidity">function _shipmentTokenizable(uint8 shipmentType) private pure returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shipmentType</code></td><td><code>uint8</code></td><td>Type of the shipment</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Flag if the shipment is tokenizable</td></tr>
</tbody></table>
</div>
<h3 id="_shipmentpartofactiverequest"><a class="header" href="#_shipmentpartofactiverequest">_shipmentPartOfActiveRequest</a></h3>
<p><em>Returns flag if the shipment is part of the active request</em></p>
<pre><code class="language-solidity">function _shipmentPartOfActiveRequest(uint256 requestId) private view returns (bool inActiveRequest);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>inActiveRequest</code></td><td><code>bool</code></td><td>Flag if the shipment is part of the active request</td></tr>
</tbody></table>
</div>
<h3 id="_setdataformessage"><a class="header" href="#_setdataformessage">_setDataForMessage</a></h3>
<p><em>Sets data for the message</em></p>
<pre><code class="language-solidity">function _setDataForMessage(bytes32 messageId, uint256 requestId) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>messageId</code></td><td><code>bytes32</code></td><td>Identifier of the message</td></tr>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>Identifier of the request</td></tr>
</tbody></table>
</div>
<h3 id="_dataformessage"><a class="header" href="#_dataformessage">_dataForMessage</a></h3>
<p><em>Returns <code>uint256</code> representation of the <code>bytes32</code> message data</em></p>
<pre><code class="language-solidity">function _dataForMessage(bytes32 messageId) private view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>messageId</code></td><td><code>bytes32</code></td><td>Identifier of the message</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td><code>uint256</code> representation of the <code>bytes32</code> message data</td></tr>
</tbody></table>
</div>
<h3 id="_asuint8status"><a class="header" href="#_asuint8status">_asUint8Status</a></h3>
<p><em>Converts <code>Status</code> enum to <code>uint8</code></em></p>
<pre><code class="language-solidity">function _asUint8Status(Status status) private pure returns (uint8);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>status</code></td><td><code>Status</code></td><td>Status enum</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td><code>uint8</code> representation of the <code>Status</code> enum</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="minttokensmessagesent"><a class="header" href="#minttokensmessagesent">MintTokensMessageSent</a></h3>
<p><em>Emitted when a <code>mintTokens</code> message is send to the bridge</em></p>
<pre><code class="language-solidity">event MintTokensMessageSent(uint256 indexed requestId, bytes32 indexed messageId);
</code></pre>
<h3 id="releasetokensmessagesent"><a class="header" href="#releasetokensmessagesent">ReleaseTokensMessageSent</a></h3>
<p><em>Emitted when a <code>releaseTokens</code> message is sent to the bridge</em></p>
<pre><code class="language-solidity">event ReleaseTokensMessageSent(uint256 indexed requestId, bytes32 indexed messageId);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="requestnotexist"><a class="header" href="#requestnotexist">RequestNotExist</a></h3>
<p><em>Request does not exist</em></p>
<pre><code class="language-solidity">error RequestNotExist(uint256 requestId);
</code></pre>
<h3 id="shipmentnottokenizable"><a class="header" href="#shipmentnottokenizable">ShipmentNotTokenizable</a></h3>
<p><em>Shipment not tokenizable</em></p>
<pre><code class="language-solidity">error ShipmentNotTokenizable(uint256 shipmentId);
</code></pre>
<h3 id="shipmentnotapproved"><a class="header" href="#shipmentnotapproved">ShipmentNotApproved</a></h3>
<p><em>Shipment not approved</em></p>
<pre><code class="language-solidity">error ShipmentNotApproved(uint256 shipmentId);
</code></pre>
<h3 id="shipmentinanotherrequest"><a class="header" href="#shipmentinanotherrequest">ShipmentInAnotherRequest</a></h3>
<p><em>Shipment already in another request</em></p>
<pre><code class="language-solidity">error ShipmentInAnotherRequest(uint256 shipmentId, uint256 requestId);
</code></pre>
<h3 id="invalidrequeststatus"><a class="header" href="#invalidrequeststatus">InvalidRequestStatus</a></h3>
<p><em>Unexpected request status</em></p>
<pre><code class="language-solidity">error InvalidRequestStatus(uint256 requestId, Status expectedStatus, Status actualStatus);
</code></pre>
<h3 id="requestcannotberecreated"><a class="header" href="#requestcannotberecreated">RequestCannotBeRecreated</a></h3>
<p><em>Request cannot be recreated</em></p>
<pre><code class="language-solidity">error RequestCannotBeRecreated(uint256 requestId);
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="status"><a class="header" href="#status">Status</a></h3>
<p><em>Possible statuses of the tokenization request</em></p>
<pre><code class="language-solidity">enum Status {
    NONE,
    CREATED,
    APPROVED,
    COMPLETED,
    REJECTED,
    REVERTED
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../contracts/certs-management/tokenization/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../../contracts/certs-management/tokenization/TokenizationStorage.sol/contract.TokenizationStorage.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../contracts/certs-management/tokenization/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../../contracts/certs-management/tokenization/TokenizationStorage.sol/contract.TokenizationStorage.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../../solidity.min.js"></script>


    </div>
    </body>
</html>
